#!/bin/bash

date
start_time=$(date +%s)

CUR_DIR=$(pwd)

CORE_NUM=$(nproc)
GROUP_NUM=8
THREAD_NUM=$((CORE_NUM / GROUP_NUM))

datasets=(
	"ecology2"
	"GL7d16"
	"ldoor"
	"Hardesty1"
	"Hardesty2"
	"Emilia_923"
	"t2em"
	"tmt_unsym"
	"web-Google"
	"tx2010"
	"wheel_601"
	"CurlCurl_2"
	"PFlow_742"
	"amazon-2008"
	"tmt_sym"
	"apache2"
	"Chevron4"
	"ca2010"
	"ASIC_680ks"
	"3Dspectralwave"
	"pre2"
	"Fault_639"
	"dielFilterV2clx"
	"gsm_106857"
	"ch8-8-b5"
	"parabolic_fem"
	"mc2depi"
	"rgg_n_2_19_s0"
	"delaunay_n19"
	"af_shell9"
	"af_shell6"
	"af_shell8"
	"af_shell5"
	"af_shell7"
	"af_shell2"
	"af_shell4"
	"af_shell3"
	"af_shell1"
	"af_2_k101"
	"af_1_k101"
	"af_3_k101"
	"af_0_k101"
	"af_4_k101"
	"af_5_k101"
	"fem_hifreq_circuit"
	"fl2010"
	"GL7d15"
	"kim2"
	"il2010"
	"auto"
	"cage13"
	"largebasis"
	"ch7-9-b5"
	"pa2010"
	"msdoor"
	"amazon0505"
	"amazon0601"
	"amazon0312"
	"marine1"
	"language"
	"test1"
	"NotreDame_actors"
	"helm2d03"
	"darcy003"
	"mario002"
	"Chevron3"
	"ch8-8-b4"
	"oh2010"
	"ny2010"
	"kneser_10_4_1"
	"rel8"
	"relat8"
	"c-big"
	"mo2010"
	"com-Amazon"
	"mi2010"
	"dblp-2010"
	"NotreDame_www"
	"web-NotreDame"
	"cnr-2000"
	"Linux_call_graph"
	"ch7-9-b4"
	"com-DBLP"
	"coAuthorsDBLP"
	"3Dspectralwave2"
	"ga2010"
	"nc2010"
	"va2010"
	"Stanford"
	"iChem_Jacobian"
	"ok2010"
	"citationCiteseer"
	"in2010"
	"email-EuAll"
	"rgg_n_2_18_s0"
	"delaunay_n18"
	"amazon0302"
	"offshore"
	"mn2010"
	"torso3"
	"Lin"
	"wi2010"
	"al2010"
	"BenElechi1"
	"az2010"
	"patents_main"
	"Si87H76"
	"tn2010"
	"image_interp"
	"ks2010"
	"mesh_deform"
	"bmw3_2"
	"coAuthorsCiteseer"
	"CurlCurl_1"
	"HTC_336_4438"
	"HTC_336_9129"
	"halfb"
	"radiation"
	"CO"
	"hood"
	"pwtk"
	"ia2010"
	"m14b"
	"troll"
	"stomach"
	"mac_econ_fwd500"
	"ss1"
	"la2010"
	"thermomech_dM"
	"thermomech_dK"
	"fcondp2"
	"co2010"
	"m133-b3"
	"shar_te2-b2"
	"shar_te2-b3"
	"fullb"
	"n4c6-b8"
	"power197k"
	"or2010"
	"wa2010"
	"sx-superuser"
	"ne2010"
	"caidaRouterLevel"
	"turon_m"
	"hvdc2"
	"ar2010"
	"d_pretok"
	"sc2010"
	"ohne2"
	"TEM181302"
	"cont-300"
	"shipsec5"
	"Goodwin_127"
	"ms2010"
	"GL7d14"
	"scircuit"
	"nj2010"
	"mono_500Hz"
	"nm2010"
	"n4c6-b7"
	"ky2010"
	"PR02R"
	"crashbasis"
	"majorbasis"
	"sx-askubuntu"
	"ma2010"
	"xenon2"
	"wave"
	"para-8"
	"para-10"
	"para-9"
	"para-5"
	"para-7"
	"para-6"
	"power9"
	"gearbox"
	"para-4"
	"TEM152078"
	"pkustk14"
	"G2_circuit"
	"id2010"
	"bmwcra_1"
	"FEM_3D_thermal2"
	"Dubcova3"
	"md2010"
	"144"
	"engine"
	"fe_ocean"
	"bmw7st_1"
	"ch7-8-b4"
	"ch7-8-b5"
	"shipsec1"
	"vsp_finan512_scagr7-2c_rlfddd"
	"wv2010"
	"nd2010"
	"Ga19As19H42"
	"mt2010"
	"soc-sign-epinions"
	"delaunay_n17"
	"rgg_n_2_17_s0"
	"cage12"
	"usroads"
	"boneS01"
	"matrix-new_3"
	"internet"
	"cfd2"
	"ship_003"
	"cop20k_A"
	"twotone"
	"D6-6"
	"imagesensor"
	"ch8-8-b3"
	"torso2"
	"barrier2-9"
	"barrier2-11"
	"barrier2-10"
	"ut2010"
	"shipsec8"
	"luxembourg_osm"
	"Ga10As10H30"
	"barrier2-1"
	"barrier2-2"
	"barrier2-3"
	"barrier2-4"
	"Ge99H100"
	"Ge87H76"
	"Baumann"
	"598a"
	"rajat23"
	"lung2"
	"x104"
	"GL7d18"
	"GL7d17"
	"rel9"
	"Rucci1"
	"patents"
	"cit-Patents"
	"wiki-talk-temporal"
	"Hamrle3"
	"great-britain_osm"
	"netherlands_osm"
	"belgium_osm"
	"italy_osm"
	"roadNet-CA"
	"roadNet-TX"
	"webbase-1M"
	"roadNet-PA"
	"wikipedia-20051105"
	"hugetric-00020"
	"hugetric-00010"
	"debr"
	"hugetric-00000"
	"hugetrace-00000"
	"rajat31"
	"venturiLevel3"
	"G3_circuit"
	"adaptive"
	"delaunay_n20"
	"delaunay_n22"
	"delaunay_n21"
	"delaunay_n23"
	"AS365"
	"NACA0015"
	"M6"
	"NLR"
	"333SP"
	"Hardesty3"
	"ecology1"
	"atmosmodj"
	"atmosmodd"
	"atmosmodm"
	"atmosmodl"
	"CurlCurl_4"
	"CurlCurl_3"
	"cage15"
	"cage14"
	"kkt_power"
	"circuit5M_dc"
	"Freescale1"
	"memchip"
	"thermal2"
	"StocF-1465"
	"packing-500x100x100-b050"
	"channel-500x100x100-b050"
	"vas_stokes_1M"
	"vas_stokes_2M"
	"rgg_n_2_20_s0"
	"rgg_n_2_21_s0"
	"ss"
	"rgg_n_2_22_s0"
	"nlpkkt80"
	"nlpkkt120"
	"rgg_n_2_23_s0"
	"dgreen"
	"nv2"
	"dielFilterV2real"
	"Hook_1498"
	"Geo_1438"
	"af_shell10"
	"Transport"
	"Serena"
	"nlpkkt160"
	"Queen_4147"
	"Bump_2911"
)

# Define the tamu_ones command function
tamu_ones_command() {
	local dataset=$1
	local core=$2
	# echo $dataset $core
	numactl --physcpubind=$core ./bin/tamu_ones $dataset
}

# Export the tamu_ones command so it's available to parallel
export -f tamu_ones_command


cd ../..
bash clean.sh
mkdir build
cd build
cmake .. -DUSE_HUGE=true -DTHREAD_NUM=$THREAD_NUM -DNUMA_NODE_IDX=1 -DCFG_PATH=config/mc/mxc0.cfg
make -j $(( $(nproc) / 4 ))
cd ..
# parallel -j "$GROUP_NUM" tamu_ones_command {} '$(( ({} - 1) % '"$GROUP_NUM"' ))' ::: "${datasets[@]}"
parallel -j "$GROUP_NUM" tamu_ones_command {1} '$(( ({#} - 1) % '"$GROUP_NUM"' ))' ::: "${datasets[@]}"
bash clean.sh
cd ${CUR_DIR}

end_time=$(date +%s)
duration=$((end_time - start_time))
echo "Duration: $duration seconds"
date







